!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vega-util"),require("vega-canvas"),require("vega-loader"),require("d3-shape"),require("d3-path")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-canvas","vega-loader","d3-shape","d3-path"],e):e((t=t||self).vega={},t.vega,t.vega,t.vega,t.d3,t.d3)}(this,(function(t,e,n,i,r,o){"use strict";function s(t){this.clear(),t&&this.union(t)}var a=s.prototype;a.clone=function(){return new s(this)},a.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},a.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},a.equals=function(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},a.set=function(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},a.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},a.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},a.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},a.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},a.rotate=function(t,e,n){const i=this.rotatedPoints(t,e,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},a.rotatedPoints=function(t,e,n){var{x1:i,y1:r,x2:o,y2:s}=this,a=Math.cos(t),u=Math.sin(t),l=e-e*a+n*u,h=n-e*u-n*a;return[a*i-u*r+l,u*i+a*r+h,a*i-u*s+l,u*i+a*s+h,a*o-u*r+l,u*o+a*r+h,a*o-u*s+l,u*o+a*s+h]},a.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},a.intersect=function(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},a.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},a.alignsWith=function(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},a.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},a.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},a.width=function(){return this.x2-this.x1},a.height=function(){return this.y2-this.y1};var u=0;const l="p_";function h(t){return t&&t.gradient}function c(t,e,n){let i=t.id,r=t.gradient,o="radial"===r?l:"";return i||(i=t.id="gradient_"+u++,"radial"===r?(t.x1=f(t.x1,.5),t.y1=f(t.y1,.5),t.r1=f(t.r1,0),t.x2=f(t.x2,.5),t.y2=f(t.y2,.5),t.r2=f(t.r2,.5),o=l):(t.x1=f(t.x1,0),t.y1=f(t.y1,0),t.x2=f(t.x2,1),t.y2=f(t.y2,0))),e[i]=t,"url("+(n||"")+"#"+o+i+")"}function f(t,e){return null!=t?t:e}function d(t){this.mark=t,this.bounds=this.bounds||new s}function v(t){d.call(this,t),this.items=this.items||[]}function g(t){this._pending=0,this._loader=t||i.loader()}e.inherits(v,d);var p=g.prototype;function y(t){t._pending+=1}function _(t){t._pending-=1}p.pending=function(){return this._pending},p.sanitizeURL=function(t){var e=this;return y(e),e._loader.sanitize(t,{context:"href"}).then((function(t){return _(e),t})).catch((function(){return _(e),null}))},p.loadImage=function(t){var e=this,i=n.image();return y(e),e._loader.sanitize(t,{context:"image"}).then((function(t){var n=t.href;if(!n||!i)throw{url:n};var r=new i;return r.onload=function(){_(e),r.loaded=!0},r.onerror=function(){_(e),r.loaded=!1},r.src=n,r})).catch((function(t){return _(e),{loaded:!1,width:0,height:0,src:t&&t.url||""}}))},p.ready=function(){var t=this;return new Promise((function(e){!function n(i){t.pending()?setTimeout((function(){n(!0)}),10):e(i)}(!1)}))};var m={basis:{curve:r.curveBasis},"basis-closed":{curve:r.curveBasisClosed},"basis-open":{curve:r.curveBasisOpen},bundle:{curve:r.curveBundle,tension:"beta",value:.85},cardinal:{curve:r.curveCardinal,tension:"tension",value:0},"cardinal-open":{curve:r.curveCardinalOpen,tension:"tension",value:0},"cardinal-closed":{curve:r.curveCardinalClosed,tension:"tension",value:0},"catmull-rom":{curve:r.curveCatmullRom,tension:"alpha",value:.5},"catmull-rom-closed":{curve:r.curveCatmullRomClosed,tension:"alpha",value:.5},"catmull-rom-open":{curve:r.curveCatmullRomOpen,tension:"alpha",value:.5},linear:{curve:r.curveLinear},"linear-closed":{curve:r.curveLinearClosed},monotone:{horizontal:r.curveMonotoneY,vertical:r.curveMonotoneX},natural:{curve:r.curveNatural},step:{curve:r.curveStep},"step-after":{curve:r.curveStepAfter},"step-before":{curve:r.curveStepBefore}};function x(t,n,i){var r=e.hasOwnProperty(m,t)&&m[t],o=null;return r&&(o=r.curve||r[n||"vertical"],r.tension&&null!=i&&(o=o[r.tension](i))),o}var b={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},k=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function w(t){var e,n,i,r,o,s,a,u,l,h,c,f=[];for(u=0,h=(e=t.slice().replace(k[0],"###$1").split(k[1]).slice(1)).length;u<h;++u){for(i=(n=e[u]).slice(1).trim().replace(k[2],"$1###$2").split(k[3]),r=[s=n.charAt(0)],l=0,c=i.length;l<c;++l)(o=+i[l])===o&&r.push(o);if(a=b[s.toLowerCase()],r.length-1>a)for(l=1,c=r.length;l<c;l+=a)f.push([s].concat(r.slice(l,l+a)));else f.push(r)}return f}var T=Math.PI/180,A=Math.PI/2,M=2*Math.PI,C=Math.sqrt(3)/2,z={},P={},S=[].join;function L(t){var e=S.call(t);if(P[e])return P[e];var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],u=t[6],l=t[7],h=l*s,c=-u*a,f=u*s,d=l*a,v=Math.cos(r),g=Math.sin(r),p=Math.cos(o),y=Math.sin(o),_=.5*(o-r),m=Math.sin(.5*_),x=8/3*m*m/Math.sin(_),b=n+v-x*g,k=i+g+x*v,w=n+p,T=i+y,A=w+x*y,M=T-x*p;return P[e]=[h*b+c*k,f*b+d*k,h*A+c*M,f*A+d*M,h*w+c*T,f*w+d*T]}var R=["l",0,0,0,0,0,0,0];function q(t,e){var n=R[0]=t[0];if("a"===n||"A"===n)R[1]=e*t[1],R[2]=e*t[2],R[3]=t[3],R[4]=t[4],R[5]=t[5],R[6]=e*t[6],R[7]=e*t[7];else for(var i=1,r=t.length;i<r;++i)R[i]=e*t[i];return R}function N(t,e,n,i,r){var o,s,a,u,l,h=null,c=0,f=0,d=0,v=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),t.beginPath&&t.beginPath();for(var g=0,p=e.length;g<p;++g){switch(o=e[g],1!==r&&(o=q(o,r)),o[0]){case"l":c+=o[1],f+=o[2],t.lineTo(c+n,f+i);break;case"L":c=o[1],f=o[2],t.lineTo(c+n,f+i);break;case"h":c+=o[1],t.lineTo(c+n,f+i);break;case"H":c=o[1],t.lineTo(c+n,f+i);break;case"v":f+=o[1],t.lineTo(c+n,f+i);break;case"V":f=o[1],t.lineTo(c+n,f+i);break;case"m":c+=o[1],f+=o[2],t.moveTo(c+n,f+i);break;case"M":c=o[1],f=o[2],t.moveTo(c+n,f+i);break;case"c":s=c+o[5],a=f+o[6],d=c+o[3],v=f+o[4],t.bezierCurveTo(c+o[1]+n,f+o[2]+i,d+n,v+i,s+n,a+i),c=s,f=a;break;case"C":c=o[5],f=o[6],d=o[3],v=o[4],t.bezierCurveTo(o[1]+n,o[2]+i,d+n,v+i,c+n,f+i);break;case"s":s=c+o[3],a=f+o[4],d=2*c-d,v=2*f-v,t.bezierCurveTo(d+n,v+i,c+o[1]+n,f+o[2]+i,s+n,a+i),d=c+o[1],v=f+o[2],c=s,f=a;break;case"S":s=o[3],a=o[4],d=2*c-d,v=2*f-v,t.bezierCurveTo(d+n,v+i,o[1]+n,o[2]+i,s+n,a+i),c=s,f=a,d=o[1],v=o[2];break;case"q":s=c+o[3],a=f+o[4],d=c+o[1],v=f+o[2],t.quadraticCurveTo(d+n,v+i,s+n,a+i),c=s,f=a;break;case"Q":s=o[3],a=o[4],t.quadraticCurveTo(o[1]+n,o[2]+i,s+n,a+i),c=s,f=a,d=o[1],v=o[2];break;case"t":s=c+o[1],a=f+o[2],null===h[0].match(/[QqTt]/)?(d=c,v=f):"t"===h[0]?(d=2*c-u,v=2*f-l):"q"===h[0]&&(d=2*c-d,v=2*f-v),u=d,l=v,t.quadraticCurveTo(d+n,v+i,s+n,a+i),f=a,d=(c=s)+o[1],v=f+o[2];break;case"T":s=o[1],a=o[2],d=2*c-d,v=2*f-v,t.quadraticCurveTo(d+n,v+i,s+n,a+i),c=s,f=a;break;case"a":O(t,c+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+c+n,o[7]+f+i]),c+=o[6],f+=o[7];break;case"A":O(t,c+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),c=o[6],f=o[7];break;case"z":case"Z":t.closePath()}h=o}}function O(t,e,n,i){for(var r=function(t,e,n,i,r,o,s,a,u){var l=S.call(arguments);if(z[l])return z[l];var h=s*T,c=Math.sin(h),f=Math.cos(h),d=f*(a-t)*.5+c*(u-e)*.5,v=f*(u-e)*.5-c*(a-t)*.5,g=d*d/((n=Math.abs(n))*n)+v*v/((i=Math.abs(i))*i);g>1&&(n*=g=Math.sqrt(g),i*=g);var p=f/n,y=c/n,_=-c/i,m=f/i,x=p*a+y*u,b=_*a+m*u,k=p*t+y*e,w=_*t+m*e,C=1/((k-x)*(k-x)+(w-b)*(w-b))-.25;C<0&&(C=0);var P=Math.sqrt(C);o==r&&(P=-P);var L=.5*(x+k)-P*(w-b),R=.5*(b+w)+P*(k-x),q=Math.atan2(b-R,x-L),N=Math.atan2(w-R,k-L)-q;N<0&&1===o?N+=M:N>0&&0===o&&(N-=M);for(var O=Math.ceil(Math.abs(N/(A+.001))),E=[],I=0;I<O;++I){var D=q+I*N/O,V=q+(I+1)*N/O;E[I]=[L,R,D,V,n,i,c,f]}return z[l]=E}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n),o=0;o<r.length;++o){var s=L(r[o]);t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}}var E={circle:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,M)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i),t.lineTo(-n,i),t.lineTo(-i,i),t.lineTo(-i,n),t.lineTo(i,n),t.lineTo(i,i),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(i,-i),t.lineTo(i,-n),t.lineTo(-i,-n),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/7,r=n/2.5,o=n/8;t.moveTo(-i,n),t.lineTo(i,n),t.lineTo(i,-o),t.lineTo(r,-o),t.lineTo(0,-n),t.lineTo(-r,-o),t.lineTo(-i,-o),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,i=C*n,r=i-.5773502691896257*n,o=n/4;t.moveTo(0,-i-r),t.lineTo(-o,i-r),t.lineTo(o,i-r),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,i=C*n,r=i-.5773502691896257*n;t.moveTo(0,-i-r),t.lineTo(-n,i-r),t.lineTo(n,i-r),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=C*n;t.moveTo(0,-i),t.lineTo(-n,i),t.lineTo(n,i),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=C*n;t.moveTo(0,i),t.lineTo(-n,-i),t.lineTo(n,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=C*n;t.moveTo(i,0),t.lineTo(-i,-n),t.lineTo(-i,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=C*n;t.moveTo(-i,0),t.lineTo(i,-n),t.lineTo(i,n),t.closePath()}},stroke:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function I(t){return e.hasOwnProperty(E,t)?E[t]:function(t){if(!e.hasOwnProperty(D,t)){var n=w(t);D[t]={draw:function(t,e){N(t,n,0,0,Math.sqrt(e)/2)}}}return D[t]}(t)}var D={};function V(t){return t.x}function H(t){return t.y}function B(t){return t.width}function G(t){return t.height}function W(t){return function(){return t}}function j(){var t=V,e=H,n=B,i=G,r=W(0),s=null;function a(a,u,l){var h,c=null!=u?u:+t.call(this,a),f=null!=l?l:+e.call(this,a),d=+n.call(this,a),v=+i.call(this,a),g=+r.call(this,a);if(s||(s=h=o.path()),g<=0)s.rect(c,f,d,v);else{var p=c+d,y=f+v;s.moveTo(c+g,f),s.lineTo(p-g,f),s.quadraticCurveTo(p,f,p,f+g),s.lineTo(p,y-g),s.quadraticCurveTo(p,y,p-g,y),s.lineTo(c+g,y),s.quadraticCurveTo(c,y,c,y-g),s.lineTo(c,f+g),s.quadraticCurveTo(c,f,c+g,f),s.closePath()}if(h)return s=null,h+""||null}return a.x=function(e){return arguments.length?(t="function"==typeof e?e:W(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:W(+t),a):e},a.width=function(t){return arguments.length?(n="function"==typeof t?t:W(+t),a):n},a.height=function(t){return arguments.length?(i="function"==typeof t?t:W(+t),a):i},a.cornerRadius=function(t){return arguments.length?(r="function"==typeof t?t:W(+t),a):r},a.context=function(t){return arguments.length?(s=null==t?null:t,a):s},a}function U(){var t,e,n,i,r,s,a,u,l=null;function h(t,e,n){var i=n/2;if(r){var o=a-e,h=t-s;if(o||h){var c=Math.sqrt(o*o+h*h),f=(o/=c)*u,d=(h/=c)*u,v=Math.atan2(h,o);l.moveTo(s-f,a-d),l.lineTo(t-o*i,e-h*i),l.arc(t,e,i,v-Math.PI,v),l.lineTo(s+f,a+d),l.arc(s,a,u,v,v+Math.PI)}else l.arc(t,e,i,0,M);l.closePath()}else r=1;s=t,a=e,u=i}function c(s){var a,u,c,f=s.length,d=!1;for(null==l&&(l=c=o.path()),a=0;a<=f;++a)!(a<f&&i(u=s[a],a,s))===d&&(d=!d)&&(r=0),d&&h(+t(u,a,s),+e(u,a,s),+n(u,a,s));if(c)return l=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(i=t,c):i},c.context=function(t){return arguments.length?(l=null==t?null:t,c):l},c}function X(t){return t.x||0}function J(t){return t.y||0}function F(t){return t.cornerRadius||0}function Y(t){return!(!1===t.defined)}var Q=r.arc().startAngle((function(t){return t.startAngle||0})).endAngle((function(t){return t.endAngle||0})).padAngle((function(t){return t.padAngle||0})).innerRadius((function(t){return t.innerRadius||0})).outerRadius((function(t){return t.outerRadius||0})).cornerRadius(F),Z=r.area().x(X).y1(J).y0((function(t){return(t.y||0)+(t.height||0)})).defined(Y),$=r.area().y(J).x1(X).x0((function(t){return(t.x||0)+(t.width||0)})).defined(Y),K=r.line().x(X).y(J).defined(Y),tt=j().x(X).y(J).width((function(t){return t.width||0})).height((function(t){return t.height||0})).cornerRadius(F),et=r.symbol().type((function(t){return I(t.shape||"circle")})).size((function(t){return null==t.size?64:t.size})),nt=U().x(X).y(J).defined(Y).size((function(t){return t.size||1}));function it(t,e,n,i){return tt.context(t)(e,n,i)}function rt(t,e){return e.stroke&&0!==e.opacity&&0!==e.strokeOpacity&&t.expand(null!=e.strokeWidth?+e.strokeWidth:1),t}var ot,st=M-1e-8;function at(t){return ot=t,at}function ut(){}function lt(t,e){ot.add(t,e)}at.beginPath=ut,at.closePath=ut,at.moveTo=lt,at.lineTo=lt,at.rect=function(t,e,n,i){lt(t,e),lt(t+n,e+i)},at.quadraticCurveTo=function(t,e,n,i){lt(t,e),lt(n,i)},at.bezierCurveTo=function(t,e,n,i,r,o){lt(t,e),lt(n,i),lt(r,o)},at.arc=function(t,e,n,i,r,o){if(Math.abs(r-i)>st)return lt(t-n,e-n),void lt(t+n,e+n);var s,a,u,l,h=1/0,c=-1/0,f=1/0,d=-1/0;function v(t){u=n*Math.cos(t),l=n*Math.sin(t),u<h&&(h=u),u>c&&(c=u),l<f&&(f=l),l>d&&(d=l)}if(v(i),v(r),r!==i)if((i%=M)<0&&(i+=M),(r%=M)<0&&(r+=M),r<i&&(o=!o,s=i,i=r,r=s),o)for(r-=M,s=i-i%A,a=0;a<4&&s>r;++a,s-=A)v(s);else for(s=i-i%A+A,a=0;a<4&&s<r;++a,s+=A)v(s);lt(t+h,e+f),lt(t+c,e+d)};var ht=(ht=n.canvas(1,1))?ht.getContext("2d"):null;const ct=new s;function ft(t){return function(e,n){if(!ht)return!0;t(ht,e),ct.clear().union(e.bounds).intersect(n).round();const{x1:i,y1:r,x2:o,y2:s}=ct;for(let t=r;t<=s;++t)for(let e=i;e<=o;++e)if(ht.isPointInPath(e,t))return!0;return!1}}function dt(t,e){return e.contains(t.x||0,t.y||0)}function vt(t,e){const n=t.x||0,i=t.y||0,r=t.width||0,o=t.height||0;return e.intersects(ct.set(n,i,n+r,i+o))}function gt(t,e){const n=t.x||0,i=t.y||0;return pt(e,n,i,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i)}function pt(t,e,n,i,r){const{x1:o,y1:s,x2:a,y2:u}=t,l=i-e,h=r-n;let c,f,d,v,g=0,p=1;for(v=0;v<4;++v){if(0===v&&(c=-l,f=-(o-e)),1===v&&(c=l,f=a-e),2===v&&(c=-h,f=-(s-n)),3===v&&(c=h,f=u-n),Math.abs(c)<1e-10&&f<0)return!1;if(d=f/c,c<0){if(d>p)return!1;d>g&&(g=d)}else if(c>0){if(d<g)return!1;d<p&&(p=d)}}return!0}function yt(t,e,n){return h(n)?function(t,e,n){const i=n.width(),r=n.height(),o=e.stops,s=o.length,a="radial"===e.gradient?t.createRadialGradient(n.x1+(e.x1||.5)*i,n.y1+(e.y1||.5)*r,Math.max(i,r)*(e.r1||0),n.x1+(e.x2||.5)*i,n.y1+(e.y2||.5)*r,Math.max(i,r)*(e.r2||.5)):t.createLinearGradient(n.x1+(e.x1||0)*i,n.y1+(e.y1||0)*r,n.x1+(e.x2||1)*i,n.y1+(e.y2||0)*r);for(let t=0;t<s;++t)a.addColorStop(o[t].offset,o[t].color);return a}(t,n,e.bounds):n}function _t(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=yt(t,e,e.fill),!0)}var mt=[];function xt(t,e,n){var i=null!=(i=e.strokeWidth)?i:1;return!(i<=0)&&((n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=yt(t,e,e.stroke),t.lineWidth=i,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||mt),t.lineDashOffset=e.strokeDashOffset||0),!0))}function bt(t,e){return t.zindex-e.zindex||t.index-e.index}function kt(t){if(!t.zdirty)return t.zitems;var e,n,i,r=t.items,o=[];for(n=0,i=r.length;n<i;++n)(e=r[n]).index=n,e.zindex&&o.push(e);return t.zdirty=!1,t.zitems=o.sort(bt)}function wt(t,e){var n,i,r=t.items;if(r&&r.length){var o=kt(t);if(o&&o.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||e(r[n]);r=o}for(n=0,i=r.length;n<i;++n)e(r[n])}}function Tt(t,e){var n,i,r=t.items;if(!r||!r.length)return null;var o=kt(t);for(o&&o.length&&(r=o),i=r.length;--i>=0;)if(n=e(r[i]))return n;if(r===o)for(i=(r=t.items).length;--i>=0;)if(!r[i].zindex&&(n=e(r[i])))return n;return null}function At(t){return function(e,n,i){wt(n,(function(n){i&&!i.intersects(n.bounds)||Ct(t,e,n,n)}))}}function Mt(t){return function(e,n,i){!n.items.length||i&&!i.intersects(n.bounds)||Ct(t,e,n.items[0],n.items)}}function Ct(t,e,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(t(e,i)||(n.fill&&_t(e,n,r)&&e.fill(),n.stroke&&xt(e,n,r)&&e.stroke()))}function zt(t){return t=t||e.truthy,function(e,n,i,r,o,s){return i*=e.pixelRatio,r*=e.pixelRatio,Tt(n,(function(n){var a=n.bounds;if((!a||a.contains(o,s))&&a)return t(e,n,i,r,o,s)?n:void 0}))}}function Pt(t,e){return function(n,i,r,o){var s,a,u=Array.isArray(i)?i[0]:i,l=null==e?u.fill:e,h=u.stroke&&n.isPointInStroke;return h&&(s=u.strokeWidth,a=u.strokeCap,n.lineWidth=null!=s?s:1,n.lineCap=null!=a?a:"butt"),!t(n,i)&&(l&&n.isPointInPath(r,o)||h&&n.isPointInStroke(r,o))}}function St(t){return zt(Pt(t))}function Lt(t,e){return"translate("+t+","+e+")"}function Rt(t){return"rotate("+t+")"}function qt(t){return Lt(t.x||0,t.y||0)}function Nt(t,e,n){function i(t,n){var i=n.x||0,r=n.y||0,o=n.angle||0;t.translate(i,r),o&&t.rotate(o*=T),t.beginPath(),e(t,n),o&&t.rotate(-o),t.translate(-i,-r)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",function(t){return Lt(t.x||0,t.y||0)+(t.angle?" "+Rt(t.angle):"")}(n)),t("d",e(null,n))},bound:function(t,n){var i=n.x||0,r=n.y||0;return e(at(t),n),rt(t,n).translate(i,r),n.angle&&t.rotate(n.angle*T,i,r),t},draw:At(i),pick:St(i),isect:n||ft(i)}}var Ot=Nt("arc",(function(t,e){return Q.context(t)(e)}));function Et(t,e,n){function i(t,n){t.beginPath(),e(t,n)}var r=Pt(i);return{type:t,tag:"path",nested:!0,attr:function(t,n){var i=n.mark.items;i.length&&t("d",e(null,i))},bound:function(t,n){var i=n.items;return 0===i.length?t:(e(at(t),i),rt(t,i[0]))},draw:Mt(i),pick:function(t,e,n,i,o,s){var a=e.items,u=e.bounds;return!a||!a.length||u&&!u.contains(o,s)?null:(n*=t.pixelRatio,i*=t.pixelRatio,r(t,a,n,i)?a[0]:null)},isect:dt,tip:n}}var It=Et("area",(function(t,e){var n=e[0],i=n.interpolate||"linear";return("horizontal"===n.orient?$:Z).curve(x(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r="horizontal"===t[0].orient?e[1]:e[0],o="horizontal"===t[0].orient?"y":"x",s=t.length,a=1/0;--s>=0;)!1!==t[s].defined&&(i=Math.abs(t[s][o]-r))<a&&(a=i,n=t[s]);return n})),Dt=1;function Vt(t,n,i){var r=n.clip,o=t._defs,s=n.clip_id||(n.clip_id="clip"+Dt++),a=o.clipping[s]||(o.clipping[s]={id:s});return e.isFunction(r)?a.path=r(null):(a.width=i.width||0,a.height=i.height||0),"url(#"+s+")"}var Ht=.5;function Bt(t,e){var n=e.stroke?Ht:0;t.beginPath(),it(t,e,n,n)}var Gt=Pt(Bt);var Wt={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",qt(e))},bound:function(t,e){if(!e.clip&&e.items)for(var n=e.items,i=0,r=n.length;i<r;++i)t.union(n[i].bounds);return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),rt(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n){var i=this;wt(e,(function(e){var r,o=e.x||0,s=e.y||0,a=e.width||0,u=e.height||0;t.save(),t.translate(o,s),(e.stroke||e.fill)&&(r=null==e.opacity?1:e.opacity)>0&&(Bt(t,e),e.fill&&_t(t,e,r)&&t.fill(),e.stroke&&xt(t,e,r)&&t.stroke()),e.clip&&(t.beginPath(),t.rect(0,0,a,u),t.clip()),n&&n.translate(-o,-s),wt(e,(function(e){i.draw(t,e,n)})),n&&n.translate(o,s),t.restore()}))},pick:function(t,e,n,i,r,o){if(e.bounds&&!e.bounds.contains(r,o)||!e.items)return null;var s=this,a=n*t.pixelRatio,u=i*t.pixelRatio;return Tt(e,(function(l){var h,c,f,d;if(!(d=l.bounds)||d.contains(r,o))return c=l.x||0,f=l.y||0,t.save(),t.translate(c,f),c=r-c,f=o-f,!(h=Tt(l,(function(t){return function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,c,f)?s.pick(t,n,i,c,f):null})))&&!1!==e.interactive&&(l.fill||l.stroke)&&Gt(t,l,a,u)&&(h=l),t.restore(),h||null}))},isect:vt,background:function(t,e){var n=e.stroke?Ht:0;t("class","background"),t("d",it(null,e,n,n))},foreground:function(t,e,n){t("clip-path",e.clip?Vt(n,e,e):null)}};function jt(t,e){var n=t.image;return n&&n.url===t.url||(n={loaded:!1,width:0,height:0},e.loadImage(t.url).then((function(e){t.image=e,t.image.url=t.url}))),n}function Ut(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function Xt(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function Jt(t,e){return"center"===t?e/2:"right"===t?e:0}function Ft(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var Yt={type:"image",tag:"image",nested:!1,attr:function(t,e,n){var i=jt(e,n),r=e.x||0,o=e.y||0,s=Ut(e,i),a=Xt(e,i),u=!1===e.aspect?"none":"xMidYMid";r-=Jt(e.align,s),o-=Ft(e.baseline,a),t("href",i.src||"","http://www.w3.org/1999/xlink","xlink:href"),t("transform",Lt(r,o)),t("width",s),t("height",a),t("preserveAspectRatio",u)},bound:function(t,e){var n=e.image,i=e.x||0,r=e.y||0,o=Ut(e,n),s=Xt(e,n);return i-=Jt(e.align,o),r-=Ft(e.baseline,s),t.set(i,r,i+o,r+s)},draw:function(t,e,n){var i=this;wt(e,(function(e){if(!n||n.intersects(e.bounds)){var r,o,s,a,u=jt(e,i),l=e.x||0,h=e.y||0,c=Ut(e,u),f=Xt(e,u);l-=Jt(e.align,c),h-=Ft(e.baseline,f),!1!==e.aspect&&(o=u.width/u.height,s=e.width/e.height,o==o&&s==s&&o!==s&&(s<o?(h+=(f-(a=c/o))/2,f=a):(l+=(c-(a=f*o))/2,c=a))),u.loaded&&(t.globalAlpha=null!=(r=e.opacity)?r:1,t.drawImage(u,l,h,c,f))}}))},pick:zt(),isect:e.truthy,get:jt,xOffset:Jt,yOffset:Ft},Qt=Et("line",(function(t,e){var n=e[0],i=n.interpolate||"linear";return K.curve(x(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r=Math.pow(t[0].strokeWidth||1,2),o=t.length;--o>=0;)if(!1!==t[o].defined&&(n=t[o].x-e[0])*n+(i=t[o].y-e[1])*i<r)return t[o];return null}));function Zt(t,e){var n=e.path;if(null==n)return!0;var i=e.pathCache;i&&i.path===n||((e.pathCache=i=w(n)).path=n),N(t,i,e.x,e.y)}var $t={type:"path",tag:"path",nested:!1,attr:function(t,e){t("transform",qt(e)),t("d",e.path)},bound:function(t,e){return Zt(at(t),e)?t.set(0,0,0,0):rt(t,e)},draw:At(Zt),pick:St(Zt),isect:ft(Zt)};function Kt(t,e){t.beginPath(),it(t,e)}var te={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",it(null,e))},bound:function(t,e){var n,i;return rt(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)},draw:At(Kt),pick:St(Kt),isect:vt};function ee(t,e,n){var i,r,o,s;return!(!e.stroke||!xt(t,e,n))&&(i=e.x||0,r=e.y||0,o=null!=e.x2?e.x2:i,s=null!=e.y2?e.y2:r,t.beginPath(),t.moveTo(i,r),t.lineTo(o,s),!0)}var ne,ie={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",qt(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,i;return rt(t.set(n=e.x||0,i=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i),e)},draw:function(t,e,n){wt(e,(function(e){if(!n||n.intersects(e.bounds)){var i=null==e.opacity?1:e.opacity;i&&ee(t,e,i)&&t.stroke()}}))},pick:zt((function(t,e,n,i){return!!t.isPointInStroke&&(ee(t,e,1)&&t.isPointInStroke(n,i))})),isect:gt},re=Nt("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),oe=Nt("symbol",(function(t,e){return et.context(t)(e)}),dt),se={height:ce,measureWidth:le,estimateWidth:ae,width:ae,canvas:fe};function ae(t,e){return ne=ce(t),ue(ge(t,e))}function ue(t){return~~(.8*t.length*ne)}function le(t,e){return ce(t)<=0?0:(ht.font=ye(t),he(ge(t,e)))}function he(t){return ht.measureText(t).width}function ce(t){return null!=t.fontSize?t.fontSize:11}function fe(t){se.width=t&&ht?le:ae}function de(t){return null!=t.lineHeight?t.lineHeight:ce(t)+2}function ve(t){return n=t.lineBreak&&t.text&&!e.isArray(t.text)?t.text.split(t.lineBreak):t.text,e.isArray(n)?n.length>1?n:n[0]:n;var n}function ge(t,e){return null==e?"":t.limit>0?function(t,e){var n,i=+t.limit,r=e+"";se.width===le?(ht.font=ye(t),n=he):(ne=ce(t),n=ue);if(n(r)<i)return r;var o,s=t.ellipsis||"â€¦",a="rtl"===t.dir,u=0,l=r.length;if(i-=n(s),a){for(;u<l;)o=u+l>>>1,n(r.slice(o))>i?u=o+1:l=o;return s+r.slice(u)}for(;u<l;)o=1+(u+l>>>1),n(r.slice(0,o))<i?u=o:l=o-1;return r.slice(0,u)+s}(t,e):e+""}function pe(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function ye(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+ce(t)+"px "+pe(t,e)}function _e(t){var e=t.baseline,n=ce(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:0)}fe(!0);var me={left:"start",center:"middle",right:"end"},xe=new s;function be(t){var e,n=t.x||0,i=t.y||0,r=t.radius||0;return r&&(e=(t.theta||0)-A,n+=r*Math.cos(e),i+=r*Math.sin(e)),xe.x1=n,xe.y1=i,xe}function ke(t,n,i){var r,o=se.height(n),s=n.align,a=be(n),u=a.x1,l=a.y1,h=n.dx||0,c=(n.dy||0)+_e(n)-Math.round(.8*o),f=ve(n);if(e.isArray(f)?(o+=de(n)*(f.length-1),r=f.reduce((t,e)=>Math.max(t,se.width(n,e)),0)):r=se.width(n,f),"center"===s?h-=r/2:"right"===s&&(h-=r),t.set(h+=u,c+=l,h+r,c+o),n.angle&&!i)t.rotate(n.angle*T,u,l);else if(2===i)return t.rotatedPoints(n.angle*T,u,l);return t}var we={arc:Ot,area:It,group:Wt,image:Yt,line:Qt,path:$t,rect:te,rule:ie,shape:re,symbol:oe,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,i=e.dx||0,r=(e.dy||0)+_e(e),o=be(e),s=o.x1,a=o.y1,u=e.angle||0;t("text-anchor",me[e.align]||"start"),u?(n=Lt(s,a)+" "+Rt(u),(i||r)&&(n+=" "+Lt(i,r))):n=Lt(s+i,a+r),t("transform",n)},bound:ke,draw:function(t,n,i){wt(n,(function(n){var r,o,s,a,u,l,h,c;if((!i||i.intersects(n.bounds))&&n.text&&!(0===(r=null==n.opacity?1:n.opacity)||n.fontSize<=0)){if(t.font=ye(n),t.textAlign=n.align||"left",s=(o=be(n)).x1,a=o.y1,n.angle&&(t.save(),t.translate(s,a),t.rotate(n.angle*T),s=a=0),s+=n.dx||0,a+=(n.dy||0)+_e(n),h=ve(n),e.isArray(h))for(l=de(n),u=0;u<h.length;++u)c=ge(n,h[u]),n.fill&&_t(t,n,r)&&t.fillText(c,s,a),n.stroke&&xt(t,n,r)&&t.strokeText(c,s,a),a+=l;else c=ge(n,h),n.fill&&_t(t,n,r)&&t.fillText(c,s,a),n.stroke&&xt(t,n,r)&&t.strokeText(c,s,a);n.angle&&t.restore()}}))},pick:zt((function(t,e,n,i,r,o){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var s=be(e),a=s.x1,u=s.y1,l=ke(xe,e,1),h=-e.angle*T,c=Math.cos(h),f=Math.sin(h),d=c*r-f*o+(a-c*a+f*u),v=f*r+c*o+(u-f*a-c*u);return l.contains(d,v)})),isect:function(t,e){var n=ke(xe,t,2);return pt(e,n[0],n[1],n[2],n[3])||pt(e,n[0],n[1],n[4],n[5])||pt(e,n[4],n[5],n[6],n[7])||pt(e,n[2],n[3],n[6],n[7])}},trail:Et("trail",(function(t,e){return nt.context(t)(e)}),(function(t,e){for(var n,i,r=t.length;--r>=0;)if(!1!==t[r].defined&&(n=t[r].x-e[0])*n+(i=t[r].y-e[1])*i<(n=t[r].size||1)*n)return t[r];return null}))};function Te(t,e,n){var i=we[t.mark.marktype],r=e||i.bound;return i.nested&&(t=t.mark),r(t.bounds||(t.bounds=new s),t,n)}var Ae={mark:null};function Me(t,e,n){var i,r,o,a,u=we[t.marktype],l=u.bound,h=t.items,c=h&&h.length;if(u.nested)return c?o=h[0]:(Ae.mark=t,o=Ae),a=Te(o,l,n),e=e&&e.union(a)||a;if(e=e||t.bounds&&t.bounds.clear()||new s,c)for(i=0,r=h.length;i<r;++i)e.union(Te(h[i],l,n));return t.bounds=e}var Ce=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant"];function ze(t,e){return JSON.stringify(t,Ce,e)}function Pe(t){return function t(e){var n,i,r,o=e.marktype,s=e.items;if(s)for(i=0,r=s.length;i<r;++i)n=o?"mark":"group",s[i][n]=e,s[i].zindex&&(s[i][n].zdirty=!0),"group"===(o||n)&&t(s[i]);o&&Me(e);return e}("string"==typeof t?JSON.parse(t):t)}function Se(t){arguments.length?this.root=Pe(t):(this.root=Re({marktype:"group",name:"root",role:"frame"}),this.root.items=[new v(this.root)])}var Le=Se.prototype;function Re(t,e){return{bounds:new s,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0}}function qe(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function Ne(t,e){e=e.toLowerCase();for(var n=t.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===e)return n[i]}function Oe(t,e,n,i){var r,o=t.childNodes[e];return o&&o.tagName.toLowerCase()===n.toLowerCase()||(r=o||null,o=qe(t.ownerDocument,n,i),t.insertBefore(o,r)),o}function Ee(t,e){for(var n=t.childNodes,i=n.length;i>e;)t.removeChild(n[--i]);return t}function Ie(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function De(t,e){var n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function Ve(t,e){this._active=null,this._handlers={},this._loader=t||i.loader(),this._tooltip=e||He}function He(t,e,n,i){t.element().setAttribute("title",i||"")}Le.toJSON=function(t){return ze(this.root,t||0)},Le.mark=function(t,e,n){var i=Re(t,e=e||this.root.items[0]);return e.items[n]=i,i.zindex&&(i.group.zdirty=!0),i};var Be=Ve.prototype;function Ge(t){this._el=null,this._bgcolor=null,this._loader=new g(t)}Be.initialize=function(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},Be.element=function(){return this._el},Be.canvas=function(){return this._el&&this._el.firstChild},Be.origin=function(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},Be.scene=function(t){return arguments.length?(this._scene=t,this):this._scene},Be.on=function(){},Be.off=function(){},Be._handlerIndex=function(t,e,n){for(var i=t?t.length:0;--i>=0;)if(t[i].type===e&&(!n||t[i].handler===n))return i;return-1},Be.handlers=function(t){var e,n=this._handlers,i=[];if(t)i.push.apply(i,n[this.eventName(t)]);else for(e in n)i.push.apply(i,n[e]);return i},Be.eventName=function(t){var e=t.indexOf(".");return e<0?t:t.slice(0,e)},Be.handleHref=function(t,e,n){this._loader.sanitize(n,{context:"href"}).then((function(e){var n=new MouseEvent(t.type,t),i=qe(null,"a");for(var r in e)i.setAttribute(r,e[r]);i.dispatchEvent(n)})).catch((function(){}))},Be.handleTooltip=function(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,i){var r,o,s=t&&t.mark;if(s&&(r=we[s.marktype]).tip){for((o=De(e,n))[0]-=i[0],o[1]-=i[1];t=t.mark.group;)o[0]-=t.x||0,o[1]-=t.y||0;t=r.tip(s.items,o)}return t}(e,t,this.canvas(),this._origin);var i=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,i)}},Be.getItemBoundingClientRect=function(t){if(e=this.canvas()){for(var e,n=e.getBoundingClientRect(),i=this._origin,r=t.bounds,o=r.x1+i[0]+n.left,s=r.y1+i[1]+n.top,a=r.width(),u=r.height();t.mark&&(t=t.mark.group);)o+=t.x||0,s+=t.y||0;return{x:o,y:s,width:a,height:u,left:o,top:s,right:o+a,bottom:s+u}}};var We=Ge.prototype;We.initialize=function(t,e,n,i,r){return this._el=t,this.resize(e,n,i,r)},We.element=function(){return this._el},We.canvas=function(){return this._el&&this._el.firstChild},We.background=function(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},We.resize=function(t,e,n,i){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=i||1,this},We.dirty=function(){},We.render=function(t){var e=this;return e._call=function(){e._render(t)},e._call(),e._call=null,e},We._render=function(){},We.renderAsync=function(t){var e=this.render(t);return this._ready?this._ready.then((function(){return e})):Promise.resolve(e)},We._load=function(t,e){var n=this,i=n._loader[t](e);if(!n._ready){var r=n._call;n._ready=n._loader.ready().then((function(t){t&&r(),n._ready=null}))}return i},We.sanitizeURL=function(t){return this._load("sanitizeURL",t)},We.loadImage=function(t){return this._load("loadImage",t)};var je="mouseout";function Ue(t,e){Ve.call(this,t,e),this._down=null,this._touch=null,this._first=!0}var Xe=e.inherits(Ue,Ve);function Je(t,e,n){return function(i){var r=this._active,o=this.pickEvent(i);o===r?this.fire(t,i):(r&&r.exit||this.fire(n,i),this._active=o,this.fire(e,i),this.fire(t,i))}}function Fe(t){return function(e){this.fire(t,e),this._active=null}}Xe.initialize=function(t,e,n){var i=this._canvas=t&&Ne(t,"canvas");if(i){var r=this;this.events.forEach((function(t){i.addEventListener(t,(function(e){Xe[t]?Xe[t].call(r,e):r.fire(t,e)}))}))}return Ve.prototype.initialize.call(this,t,e,n)},Xe.canvas=function(){return this._canvas},Xe.context=function(){return this._canvas.getContext("2d")},Xe.events=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Xe.DOMMouseScroll=function(t){this.fire("mousewheel",t)},Xe.mousemove=Je("mousemove","mouseover","mouseout"),Xe.dragover=Je("dragover","dragenter","dragleave"),Xe.mouseout=Fe("mouseout"),Xe.dragleave=Fe("dragleave"),Xe.mousedown=function(t){this._down=this._active,this.fire("mousedown",t)},Xe.click=function(t){this._down===this._active&&(this.fire("click",t),this._down=null)},Xe.touchstart=function(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",t,!0)},Xe.touchmove=function(t){this.fire("touchmove",t,!0)},Xe.touchend=function(t){this.fire("touchend",t,!0),this._touch=null},Xe.fire=function(t,e,n){var i,r,o=n?this._touch:this._active,s=this._handlers[t];if(e.vegaType=t,"click"===t&&o&&o.href?this.handleHref(e,o,o.href):"mousemove"!==t&&t!==je||this.handleTooltip(e,o,t!==je),s)for(i=0,r=s.length;i<r;++i)s[i].handler.call(this._obj,e,o)},Xe.on=function(t,e){var n=this.eventName(t),i=this._handlers;return this._handlerIndex(i[n],t,e)<0&&(i[n]||(i[n]=[])).push({type:t,handler:e}),this},Xe.off=function(t,e){var n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&i.splice(r,1),this},Xe.pickEvent=function(t){var e=De(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},Xe.pick=function(t,e,n,i,r){var o=this.context();return we[t.marktype].pick.call(this,o,t,e,n,i,r)};var Ye="undefined"!=typeof window&&window.devicePixelRatio||1;function Qe(t){Ge.call(this,t),this._redraw=!1,this._dirty=new s}var Ze=e.inherits(Qe,Ge),$e=Ge.prototype,Ke=new s;function tn(t,e){Ve.call(this,t,e);var n=this;n._hrefHandler=nn(n,(function(t,e){e&&e.href&&n.handleHref(t,e,e.href)})),n._tooltipHandler=nn(n,(function(t,e){n.handleTooltip(t,e,t.type!==je)}))}Ze.initialize=function(t,e,i,r,o,s){return this._options=s,this._canvas=n.canvas(1,1,s&&s.type),t&&(Ee(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),$e.initialize.call(this,t,e,i,r,o)},Ze.resize=function(t,e,n,i){return $e.resize.call(this,t,e,n,i),function(t,e,n,i,r,o){var s,a="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,u=t.getContext("2d"),l=a?Ye:r;for(s in t.width=e*l,t.height=n*l,o)u[s]=o[s];a&&1!==l&&(t.style.width=e+"px",t.style.height=n+"px"),u.pixelRatio=l,u.setTransform(l,0,0,l,l*i[0],l*i[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options&&this._options.context),this._redraw=!0,this},Ze.canvas=function(){return this._canvas},Ze.context=function(){return this._canvas?this._canvas.getContext("2d"):null},Ze.dirty=function(t){var e=function(t,e){if(null==e)return t;for(var n=Ke.clear().union(t);null!=e;e=e.mark.group)n.translate(e.x||0,e.y||0);return n}(t.bounds,t.mark.group);this._dirty.union(e)},Ze._render=function(t){var e=this.context(),n=this._origin,i=this._width,r=this._height,o=this._dirty;return e.save(),this._redraw||o.empty()?(this._redraw=!1,o=null):o=function(t,e,n){return e.expand(1).round(),e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(e,o,n),this.clear(-n[0],-n[1],i,r),this.draw(e,t,o),e.restore(),this._dirty.clear(),this},Ze.draw=function(t,n,i){var r=we[n.marktype];n.clip&&function(t,n){var i=n.clip;if(t.save(),t.beginPath(),e.isFunction(i))i(t);else{var r=n.group;t.rect(0,0,r.width||0,r.height||0)}t.clip()}(t,n),r.draw.call(this,t,n,i),n.clip&&t.restore()},Ze.clear=function(t,e,n,i){var r=this.context();r.clearRect(t,e,n,i),null!=this._bgcolor&&(r.fillStyle=this._bgcolor,r.fillRect(t,e,n,i))};var en=e.inherits(tn,Ve);function nn(t,e){return function(n){var i=n.target.__data__;n.vegaType=n.type,i=Array.isArray(i)?i[0]:i,e.call(t._obj,n,i)}}function rn(t,e,n){var i,r,o="<"+t;if(e)for(i in e)null!=(r=e[i])&&(o+=" "+i+'="'+r+'"');return n&&(o+=" "+n),o+">"}function on(t){return"</"+t+">"}en.initialize=function(t,e,n){var i=this._svg;return i&&(i.removeEventListener("click",this._hrefHandler),i.removeEventListener("mousemove",this._tooltipHandler),i.removeEventListener(je,this._tooltipHandler)),this._svg=i=t&&Ne(t,"svg"),i&&(i.addEventListener("click",this._hrefHandler),i.addEventListener("mousemove",this._tooltipHandler),i.addEventListener(je,this._tooltipHandler)),Ve.prototype.initialize.call(this,t,e,n)},en.canvas=function(){return this._svg},en.on=function(t,e){var n=this.eventName(t),i=this._handlers;if(this._handlerIndex(i[n],t,e)<0){var r={type:t,handler:e,listener:nn(this,e)};(i[n]||(i[n]=[])).push(r),this._svg&&this._svg.addEventListener(n,r.listener)}return this},en.off=function(t,e){var n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this};var sn={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},an={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},un=Object.keys(an),ln=sn.xmlns;function hn(t){Ge.call(this,t),this._dirtyID=1,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var cn=e.inherits(hn,Ge),fn=Ge.prototype;function dn(t,e,n){var i,r,o;if("radial"===e.gradient){var s=Oe(t,n++,"pattern",ln);s.setAttribute("id",l+e.id),s.setAttribute("viewBox","0,0,1,1"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("preserveAspectRatio","xMidYMid slice"),(s=Oe(s,0,"rect",ln)).setAttribute("width","1"),s.setAttribute("height","1"),s.setAttribute("fill","url("+kn()+"#"+e.id+")"),(t=Oe(t,n++,"radialGradient",ln)).setAttribute("id",e.id),t.setAttribute("fx",e.x1),t.setAttribute("fy",e.y1),t.setAttribute("fr",e.r1),t.setAttribute("cx",e.x2),t.setAttribute("cy",e.y2),t.setAttribute("r",e.r2)}else(t=Oe(t,n++,"linearGradient",ln)).setAttribute("id",e.id),t.setAttribute("x1",e.x1),t.setAttribute("x2",e.x2),t.setAttribute("y1",e.y1),t.setAttribute("y2",e.y2);for(i=0,r=e.stops.length;i<r;++i)(o=Oe(t,i,"stop",ln)).setAttribute("offset",e.stops[i].offset),o.setAttribute("stop-color",e.stops[i].color);return Ee(t,i),n}function vn(t,e,n){var i;return(t=Oe(t,n,"clipPath",ln)).setAttribute("id",e.id),e.path?(i=Oe(t,0,"path",ln)).setAttribute("d",e.path):((i=Oe(t,0,"rect",ln)).setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",e.width),i.setAttribute("height",e.height)),n+1}function gn(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function pn(t,e,n,i,r){var o,s=t._svg;if(!s&&(s=qe(o=e.ownerDocument,i,ln),t._svg=s,t.mark&&(s.__data__=t,s.__values__={fill:"default"},"g"===i))){var a=qe(o,"path",ln);a.setAttribute("class","background"),s.appendChild(a),a.__data__=t;var u=qe(o,"g",ln);s.appendChild(u),u.__data__=t}return(s.ownerSVGElement!==r||function(t){var e=t.mark||t.group;return e&&e.items.length>1}(t)&&s.previousSibling!==n)&&e.insertBefore(s,n?n.nextSibling:e.firstChild),s}cn.initialize=function(t,e,n,i){return t&&(this._svg=Oe(t,0,"svg",ln),this._svg.setAttribute("class","marks"),Ee(t,1),this._root=Oe(this._svg,0,"g",ln),Ee(this._svg,1)),this._defs={gradient:{},clipping:{}},this.background(this._bgcolor),fn.initialize.call(this,t,e,n,i)},cn.background=function(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),fn.background.apply(this,arguments)},cn.resize=function(t,e,n,i){return fn.resize.call(this,t,e,n,i),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},cn.canvas=function(){return this._svg},cn.svg=function(){if(!this._svg)return null;var t={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var e in sn)t[e]=sn[e];var n=this._bgcolor?rn("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+on("rect"):"";return rn("svg",t)+n+this._svg.innerHTML+on("svg")},cn._render=function(t){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,t),Ee(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},cn.updateDefs=function(){var t,e=this._svg,n=this._defs,i=n.el,r=0;for(t in n.gradient)i||(n.el=i=Oe(e,0,"defs",ln)),r=dn(i,n.gradient[t],r);for(t in n.clipping)i||(n.el=i=Oe(e,0,"defs",ln)),r=vn(i,n.clipping[t],r);i&&(0===r?(e.removeChild(i),n.el=null):Ee(i,r))},cn._resetDefs=function(){var t=this._defs;t.gradient={},t.clipping={}},cn.dirty=function(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},cn.isDirty=function(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},cn._dirtyCheck=function(){this._dirtyAll=!0;var t=this._dirty;if(!t.length)return!0;var e,n,i,r,o,s,a,u=++this._dirtyID;for(o=0,s=t.length;o<s;++o)(n=(e=t[o]).mark).marktype!==i&&(i=n.marktype,r=we[i]),n.zdirty&&n.dirty!==u&&(this._dirtyAll=!1,gn(e,u),n.items.forEach((function(t){t.dirty=u}))),n.zdirty||(e.exit?(r.nested&&n.items.length?(a=n.items[0])._svg&&this._update(r,a._svg,a):e._svg&&(a=e._svg.parentNode)&&a.removeChild(e._svg),e._svg=null):(e=r.nested?n.items[0]:e)._update!==u&&(e._svg&&e._svg.ownerSVGElement?this._update(r,e._svg,e):(this._dirtyAll=!1,gn(e,u)),e._update=u));return!this._dirtyAll},cn.draw=function(t,e,n){if(!this.isDirty(e))return e._svg;var i,r=this,o=this._svg,s=we[e.marktype],a=!1===e.interactive?"none":null,u="g"===s.tag,l=null,h=0;function c(t){var e=r.isDirty(t),n=pn(t,i,l,s.tag,o);e&&(r._update(s,n,t),u&&function(t,e,n){e=e.lastChild;var i,r=0;wt(n,(function(n){i=t.draw(e,n,i),++r})),Ee(e,1+r)}(r,n,t)),l=n,++h}return(i=pn(e,t,n,"g",o)).setAttribute("class",Ie(e)),u||i.style.setProperty("pointer-events",a),e.clip?i.setAttribute("clip-path",Vt(r,e,e.group)):i.removeAttribute("clip-path"),s.nested?e.items.length&&c(e.items[0]):wt(e,c),Ee(i,h),i};var yn=null,_n=null,mn={group:function(t,e,n){_n=e.__values__,yn=e.childNodes[1],t.foreground(bn,n,this),yn=e.childNodes[0],t.background(bn,n,this);var i=!1===n.mark.interactive?"none":null;i!==_n.events&&(yn.style.setProperty("pointer-events",i),_n.events=i)},text:function(t,n,i){var r,o,s,a,u=ve(i);e.isArray(u)?(r=(o=u.map(t=>ge(i,t))).join("\n"))!==_n.text&&(Ee(n,0),s=n.ownerDocument,a=de(i),o.forEach((t,e)=>{const r=qe(s,"tspan",ln);r.__data__=i,r.textContent=t,e&&(r.setAttribute("x",0),r.setAttribute("dy",a)),n.appendChild(r)}),_n.text=r):(o=ge(i,u))!==_n.text&&(n.textContent=o,_n.text=o),xn(n,"font-family",pe(i)),xn(n,"font-size",ce(i)+"px"),xn(n,"font-style",i.fontStyle),xn(n,"font-variant",i.fontVariant),xn(n,"font-weight",i.fontWeight)}};function xn(t,e,n){n!==_n[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),_n[e]=n)}function bn(t,e,n){e!==_n[t]&&(null!=e?n?yn.setAttributeNS(n,t,e):yn.setAttribute(t,e):n?yn.removeAttributeNS(n,t):yn.removeAttribute(t),_n[t]=e)}function kn(){var t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function wn(t){Ge.call(this,t),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}cn._update=function(t,e,n){yn=e,_n=e.__values__,t.attr(bn,n,this);var i=mn[t.type];i&&i.call(this,t,e,n),this.style(yn,n)},cn.style=function(t,e){var n,i,r,o,s;if(null!=e)for(n=0,i=un.length;n<i;++n)s=e[r=un[n]],"font"===r&&(s=pe(e)),s!==_n[r]&&(o=an[r],null==s?"fill"===o?t.style.setProperty(o,"none"):t.style.removeProperty(o):(h(s)&&(s=c(s,this._defs.gradient,kn())),t.style.setProperty(o,s+"")),_n[r]=s)};var Tn,An=e.inherits(wn,Ge),Mn=Ge.prototype;function Cn(t,e,n,i){Tn[i||t]=e}function zn(t,e,n,i){if(null==t)return"";var r,o,s,a,u,l="";for("bgrect"===n&&!1===e.interactive&&(l+="pointer-events: none; "),"text"===n&&(l+="font-family: "+pe(t)+"; ",l+="font-size: "+ce(t)+"px; ",t.fontStyle&&(l+="font-style: "+t.fontStyle+"; "),t.fontVariant&&(l+="font-variant: "+t.fontVariant+"; "),t.fontWeight&&(l+="font-weight: "+t.fontWeight+"; ")),r=0,o=un.length;r<o;++r)s=un[r],a=an[s],null==(u=t[s])?"fill"===a&&(l+="fill: none; "):"transparent"!==u||"fill"!==a&&"stroke"!==a?(h(u)&&(u=c(u,i.gradient,"")),l+=a+": "+u+"; "):l+=a+": none; ";return l?'style="'+l.trim()+'"':null}function Pn(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}An.resize=function(t,e,n,i){Mn.resize.call(this,t,e,n,i);var r=this._origin,o=this._text,s={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var a in sn)s[a]=sn[a];o.head=rn("svg",s);var u=this._bgcolor;return"transparent"!==u&&"none"!==u||(u=null),o.bg=u?rn("rect",{width:this._width,height:this._height,style:"fill: "+u+";"})+on("rect"):"",o.root=rn("g",{transform:"translate("+r+")"}),o.foot=on("g")+on("svg"),this},An.background=function(){var t=Mn.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),t},An.svg=function(){var t=this._text;return t.head+t.bg+t.defs+t.root+t.body+t.foot},An._render=function(t){return this._text.body=this.mark(t),this._text.defs=this.buildDefs(),this},An.buildDefs=function(){var t,e,n,i,r,o=this._defs,s="";for(e in o.gradient){for(r=(n=o.gradient[e]).stops,"radial"===n.gradient?(s+=rn(i="pattern",{id:l+e,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),s+=rn("rect",{width:"1",height:"1",fill:"url(#"+e+")"})+on("rect"),s+=on(i),s+=rn(i="radialGradient",{id:e,fx:n.x1,fy:n.y1,fr:n.r1,cx:n.x2,cy:n.y2,r:n.r2})):s+=rn(i="linearGradient",{id:e,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),t=0;t<r.length;++t)s+=rn("stop",{offset:r[t].offset,"stop-color":r[t].color})+on("stop");s+=on(i)}for(e in o.clipping)n=o.clipping[e],s+=rn("clipPath",{id:e}),n.path?s+=rn("path",{d:n.path})+on("path"):s+=rn("rect",{x:0,y:0,width:n.width,height:n.height})+on("rect"),s+=on("clipPath");return s.length>0?rn("defs")+s+on("defs"):""},An.attributes=function(t,e){return Tn={},t(Cn,e,this),Tn},An.href=function(t){var e,n=this,i=t.href;if(i){if(e=n._hrefs&&n._hrefs[i])return e;n.sanitizeURL(i).then((function(t){t["xlink:href"]=t.href,t.href=null,(n._hrefs||(n._hrefs={}))[i]=t}))}return null},An.mark=function(t){var n,i=this,r=we[t.marktype],o=r.tag,s=this._defs,a="";function u(u){var l=i.href(u);if(l&&(a+=rn("a",l)),n="g"!==o?zn(u,t,o,s):null,a+=rn(o,i.attributes(r.attr,u),n),"text"===o){const t=ve(u);if(e.isArray(t)){const e={x:0,dy:de(u)};for(let n=0;n<t.length;++n)a+=rn("tspan",n?e:null)+Pn(ge(u,t[n]))+on("tspan")}else a+=Pn(ge(u,t))}else"g"===o&&(a+=rn("path",i.attributes(r.background,u),zn(u,t,"bgrect",s))+on("path"),a+=rn("g",i.attributes(r.foreground,u))+i.markGroup(u)+on("g"));a+=on(o),l&&(a+=on("a"))}return"g"!==o&&!1===t.interactive&&(n='style="pointer-events: none;"'),a+=rn("g",{class:Ie(t),"clip-path":t.clip?Vt(i,t,t.group):null},n),r.nested?t.items&&t.items.length&&u(t.items[0]):wt(t,u),a+on("g")},An.markGroup=function(t){var e=this,n="";return wt(t,(function(t){n+=e.mark(t)})),n};var Sn={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},Ln={};function Rn(t,e,n,i){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const r=t.items,o=t.marktype,s=r.length;let a=0;if("group"===o)for(;a<s;++a)qn(r[a],e,n,i);else for(const t=we[o].isect;a<s;++a){let n=r[a];Nn(n,e,t)&&i.push(n)}}return i}function qn(t,e,n,i){n&&n(t.mark)&&Nn(t,e,we.group.isect)&&i.push(t);const r=t.items,o=r&&r.length;if(o){const s=t.x||0,a=t.y||0;e.translate(-s,-a);for(let t=0;t<o;++t)Rn(r[t],e,n,i);e.translate(s,a)}return i}function Nn(t,e,n){const i=t.bounds;return e.encloses(i)||e.intersects(i)&&n(t,e)}Ln.canvas=Ln.png={renderer:Qe,headless:Qe,handler:Ue},Ln.svg={renderer:hn,headless:wn,handler:tn},Ln.none={};var On=new s;var En=1e-9;function In(t,n,i){return t===n||("path"===i?Dn(t,n):t instanceof Date&&n instanceof Date?+t==+n:e.isNumber(t)&&e.isNumber(n)?Math.abs(t-n)<=En:t&&n&&(e.isObject(t)||e.isObject(n))?null!=t&&null!=n&&function(t,e){var n,i,r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(r.sort(),o.sort(),i=r.length-1;i>=0;i--)if(r[i]!=o[i])return!1;for(i=r.length-1;i>=0;i--)if(n=r[i],!In(t[n],e[n],n))return!1;return typeof t==typeof e}(t,n):t==n)}function Dn(t,e){return In(w(t),w(e))}t.Bounds=s,t.CanvasHandler=Ue,t.CanvasRenderer=Qe,t.Gradient=function(t,e){var n,i=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:i,stop:function(t,e){return i.push({offset:t,color:e}),n}}},t.GroupItem=v,t.Handler=Ve,t.Item=d,t.Marks=we,t.RenderType=Sn,t.Renderer=Ge,t.ResourceLoader=g,t.SVGHandler=tn,t.SVGRenderer=hn,t.SVGStringRenderer=wn,t.Scenegraph=Se,t.boundClip=function(t){var n=t.clip;if(e.isFunction(n))n(at(On.clear()));else{if(!n)return;On.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(On)},t.boundContext=at,t.boundItem=Te,t.boundMark=Me,t.boundStroke=rt,t.closeTag=on,t.domChild=Oe,t.domClear=Ee,t.domCreate=qe,t.domFind=Ne,t.font=ye,t.fontFamily=pe,t.fontSize=ce,t.intersect=function(t,n,i){const r=[],o=(new s).union(n),a=t.marktype;return a?Rn(t,o,i,r):"group"===a?qn(t,o,i,r):e.error("Intersect scene must be mark node or group item.")},t.intersectBoxLine=pt,t.intersectPath=ft,t.intersectPoint=dt,t.intersectRule=gt,t.lineHeight=de,t.multiLineOffset=function(t){const n=ve(t);return(e.isArray(n)?n.length-1:0)*de(t)},t.openTag=rn,t.pathCurves=x,t.pathEqual=Dn,t.pathParse=w,t.pathRectangle=j,t.pathRender=N,t.pathSymbols=I,t.pathTrail=U,t.point=De,t.renderModule=function(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(Ln[t]=e,this):Ln[t]},t.resetSVGClipId=function(){Dt=1},t.sceneEqual=In,t.sceneFromJSON=Pe,t.scenePickVisit=Tt,t.sceneToJSON=ze,t.sceneVisit=wt,t.sceneZOrder=kt,t.textMetrics=se,Object.defineProperty(t,"__esModule",{value:!0})}));